"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xhr_get(e){var t=new XMLHttpRequest;t.open("GET",e.url,!0),t.onload=function(){200==t.status?e.success&&e.success(t.response):401==t.status?e.unauthorized&&e.unauthorized():400==t.status?e.badReqeust&&e.badRequest():e.otherError&&e.otherError()},e.jwt&&t.setRequestHeader("Authorization","Bearer "+e.jwt),e.timeout&&(t.onerror=function(){e.timeout()}),t.send()}function xhr_post(e){var t=new XMLHttpRequest,a=new FormData;for(var r in e.data)a.append(r,e.data[r]);t.open("POST",e.url,!0),t.onload=function(){200==t.status?e.success&&e.success(t.response):401==t.status?e.unauthorized&&e.unauthorized():400==t.status?e.badReqeust&&e.badRequest():e.otherError&&e.otherError()},e.jwt&&t.setRequestHeader("Authorization","Bearer "+e.jwt),e.timeout&&(t.onerror=function(){e.timeout()}),t.send(a)}function parseDate(e){return new Date(Date.parse(e)).toLocaleString()}function createFragmentFromTemplate(e){var t=document.createDocumentFragment(),a=document.createElement("body");a.innerHTML=e;for(var r=void 0;r=a.firstElementChild;)t.appendChild(r);return t}function isRegisteredHTMLElement(e){return document.createElement(e).constructor!==HTMLElement}function encodeURIWithUnderscores(e){return e.replaceAll(" ","__")}function encodeURIForUser(e){return e.replaceAll(" ","__")}function decodeURIWithUnderscores(e){return e.replaceAll("__"," ")}function encodeURIForServer(e){return encodeURI(decodeURIWithUnderscores(e))}function copy(e){return e?"string"==typeof e||"number"==typeof e||"boolean"==typeof e||"function"==typeof e?e:e instanceof String?e.slice(0,e.length):Object.assign({},e):void 0}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.substring(1)},DocumentFragment.prototype.select=function(e){return this.querySelector(e)},DocumentFragment.prototype.selectAll=function(e){return this.querySelectorAll(e)},Element.prototype.selectAll=DocumentFragment.prototype.selectAll,DocumentFragment.prototype.add=function(e,t,a){if(App.router.registeredReactComponents.has(e))return ReactDOM.render(window[e](t),this);var r=document.createElement(e);for(var n in t)"innerHTML"==n?r.innerHTML=t.innerHTML:r.setAttribute(n,t[n]);return a?this.insertBefore(r,this.firstChild):this.appendChild(r),r},Element.prototype.add=DocumentFragment.prototype.add,DocumentFragment.prototype.addImg=function(e,t){var a=document.createElement("img");for(var r in e)a.setAttribute(r,e[r]);return a.onerror=function(e){"remove"==t?this.remove():"hide"==t?this.hide():"scaleDown"==t&&(this.setAttribute("width",20),this.setAttribute("height",20))},this.appendChild(a),a},Element.prototype.addImg=DocumentFragment.prototype.addImg,DocumentFragment.prototype.importTemplate=function(e){var t=document.createElement("body");e?t.innerHTML=App.router.htmlTemplates.get(e):t.innerHTML=App.router.htmlTemplates.get(App.router.currentPage);for(var a=void 0;a=t.firstElementChild;)this.appendChild(a)},Element.prototype.importTemplate=DocumentFragment.prototype.importTemplate,Element.prototype.hide=function(){this.style.visibility="hidden"},Element.prototype.remove=function(){this.parentElement.removeChild(this)},String.prototype.replaceAll=function(e,t){return this.split(e).join(t)},String.prototype.hashCode=function(){var e,t,a,r=0;if(0===this.length)return r;for(e=0,a=this.length;a>e;e++)t=this.charCodeAt(e),r=(r<<5)-r+t,r|=0;return r};var Router=function(){function e(){_classCallCheck(this,e),this.siteName=window.location.hostname+":"+window.location.port,this.defaultUrlLength=this.siteName.length+window.location.protocol.length+2,this.currentURL=this.siteName+window.location.pathname,this.dataForPage=new Map,this.Pages=new Map,this.routes={},this.availableResources=new Set,this.needAuthentication=new Map,this.appTitle=AppConfig.title?AppConfig.title:"",this.registeredReactComponents=new Set,this.htmlTemplates=new Map,this.layouts={};for(var t in AppConfig.pages){var a=AppConfig.pages[t];if(a.path.constructor===Array){var r=!0,n=!1,o=void 0;try{for(var i,s=a.path[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var u=i.value;this.setRoute(t,u)}}catch(p){n=!0,o=p}finally{try{!r&&s["return"]&&s["return"]()}finally{if(n)throw o}}}else this.setRoute(t,a.path);a.data&&this.dataForPage.set(t,a.data),void 0!==a.auth&&this.needAuthentication.set(t,a.auth)}}return _createClass(e,[{key:"setRoute",value:function(e,t){var a=t.indexOf(":"),r=void 0;if(-1!=a){var n=t.slice(0,a),o=t.slice(a,t.length);r=o.split(":"),r.map(function(e,t){""==r[t]&&r.splice(t,1),r[t].endsWith("/")&&(r[t]=r[t].slice(0,-1))}),t=n}t.endsWith("/")&&"/"!=t&&(t=t.slice(0,-1)),this.routes[t]={page:e,urlParams:r}}},{key:"navigate",value:function(e,t){this.detachedHandler(),t?this.currentURL+=e:this.currentURL=this.siteName+e,sessionStorage.getItem("lastURL")==this.currentURL?window.history.replaceState(null,null,"http://"+this.currentURL):(window.history.pushState(null,null,"http://"+this.currentURL),sessionStorage.setItem("lastURL",this.currentURL)),this.servePage(!1)}},{key:"setCurrentPageAndUrlParams",value:function(){var e=location.pathname,t=0,a=void 0;for(var r in this.routes)if(e.startsWith(r)){var n=r.length;n>t&&(t=n,a=r)}this.urlParams={},this.currentPage=this.routes[a].page;var o=e.substring(t,e.length).split("/"),i=o.shift();if(0!=t&&""==i&&(this.currentPage=this.routes[a].page,this.routes[a].urlParams)){var s=0,u=!0,p=!1,l=void 0;try{for(var d,c=this.routes[a].urlParams[Symbol.iterator]();!(u=(d=c.next()).done);u=!0){var h=d.value;if(!o[s])break;this.urlParams[h]=o[s],s++}}catch(f){p=!0,l=f}finally{try{!u&&c["return"]&&c["return"]()}finally{if(p)throw l}}}}},{key:"servePage",value:function(){this.setCurrentPageAndUrlParams();var e=this.currentLayout?this.currentLayout:"default";if(!this.currentPage)return void this.loadResources({needAuthentication:!1,layout:e,error:"pageNotFound"});var t=AppConfig.pages[this.currentPage].layout?AppConfig.pages[this.currentPage].layout:"default";this.needAuthentication.has(this.currentPage)?void 0!=App.authLevel&&App.authLevel<=this.needAuthentication.get(this.currentPage)?this.loadResources({needAuthentication:!0,layout:t}):this.loadResources({needAuthentication:!1,layout:e,error:"unauthorized"}):this.loadResources({needAuthentication:!1,layout:t})}},{key:"showError",value:function(e){var t=document.getElementsByTagName("title")[0],a=document.createElement("p");t.innerHTML=this.appTitle+"Error: ","unauthorized"===e?(a.innerHTML="<p>This page is available only to logged in users.</p>",t.innerHTML+="Unauthorized access"):"timeout"===e?(a.innerHTML="<p>We can't load this page. Server timeout.</p>",t.innerHTML+="Server timeout"):"pageNotFound"===e?(a.innerHTML="<p>Page does not exist.</p>",t.innerHTML+="Page not found"):(a.innerHTML="<p>Unexpected Error occured.</p>",t.innerHTML+="Unexpected Error"),this.renderPage({contents:a,layout:"default"})}},{key:"renderPage",value:function(e){var t=e.contents,a=e.layout,r=e.renderLayout,n=document.getElementsByTagName("body")[0];if(this.currentLayout!=a||r){for(;n.lastChild;)n.removeChild(n.lastChild);var o=new DocumentFragment;this.currentLayout=a,o.appendChild(this.layouts[a].render());var i=o.querySelector("#router-outlet");i.appendChild(t),n.appendChild(o)}else{for(var s=document.getElementById("router-outlet");s.lastChild;)s.removeChild(s.lastChild);s.appendChild(t)}}},{key:"showPage",value:function(e){void 0==e&&(e=!0);var t=this.Pages.get(this.currentPage);if(AppConfig.pages[this.currentPage].title&&(document.getElementsByTagName("title")[0].innerHTML=this.appTitle+AppConfig.pages[this.currentPage].title),t.beforePageShow&&t.beforePageShow(),AppConfig.beforePageShow){var a=!0,r=!1,n=void 0;try{for(var o,i=AppConfig.beforePageShow[Symbol.iterator]();!(a=(o=i.next()).done);a=!0){var s=o.value;s()}}catch(u){r=!0,n=u}finally{try{!a&&i["return"]&&i["return"]()}finally{if(r)throw n}}}if(t.css){var p=document.createElement("style");p.innerHTML=t.css,document.body.appendChild(p)}var l=t.init();if(l.constructor===DocumentFragment){var d=t.layout?t.layout:"default";this.renderPage({contents:l,layout:d,renderLayout:e})}else this.showError();if(t.afterPageShow&&t.afterPageShow(),AppConfig.afterPageShow){var c=!0,h=!1,f=void 0;try{for(var m,v=AppConfig.afterPageShow[Symbol.iterator]();!(c=(m=v.next()).done);c=!0){var g=m.value;g()}}catch(u){h=!0,f=u}finally{try{!c&&v["return"]&&v["return"]()}finally{if(h)throw f}}}this.detached=null,AppConfig.beforePageDetach&&(this.detached=!0),t.beforePageDetach&&(this.detached=t.beforePageDetach)}},{key:"detachedHandler",value:function(){if(this.detachedHandler){if(AppConfig.beforePageDetach){var e=!0,t=!1,a=void 0;try{for(var r,n=AppConfig.beforePageDetach[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var o=r.value;o()}}catch(i){t=!0,a=i}finally{try{!e&&n["return"]&&n["return"]()}finally{if(t)throw a}}}"function"==typeof this.detached&&this.detachedHandler()}}},{key:"prepareDataRequestURL",value:function(e){for(var t in this.urlParams)console.log(e),e=e.replace("{"+t+"}",t+"="+this.urlParams[t]);return encodeURIForServer(e)}},{key:"loadNonBlockingDataGetBlockingData",value:function(e){var t=[],a=[];if(!this.dataForPage.has(this.currentPage))return[];var r=this.dataForPage.get(this.currentPage);for(var n in r){var o=void 0,i=AppConfig.data[n];if("specific"==r[n]){var s=i.keyIndex?i.keyIndex:0;if(App.dataStore.data[n]&&i.key&&App.dataStore.data[n][this.urlParams[s]])continue;o=i.get}else"all"==r[n]&&(o=i.getAll);i.blocking?t.push({name:n,url:this.prepareDataRequestURL(o)}):a.push({name:n,url:this.prepareDataRequestURL(o)})}return App.resourceLoader.loadData(a,e),t}},{key:"getNeededScripts",value:function(e){var t=[],a=!0,r=!1,n=void 0;try{for(var o,i=e[Symbol.iterator]();!(a=(o=i.next()).done);a=!0){var s=o.value,u=AppConfig.scripts[s];this.availableResources.has(u.url)||t.push({url:u.url,type:"script"})}}catch(p){r=!0,n=p}finally{try{!a&&i["return"]&&i["return"]()}finally{if(r)throw n}}return t}},{key:"getNeededTemplates",value:function(e){var t=[],a=!0,r=!1,n=void 0;try{for(var o,i=e[Symbol.iterator]();!(a=(o=i.next()).done);a=!0){var s=o.value,u=AppConfig.templates[s];this.availableResources.has(u.url)||t.push({url:u.url,type:"template",name:s})}}catch(p){r=!0,n=p}finally{try{!a&&i["return"]&&i["return"]()}finally{if(r)throw n}}return t}},{key:"getNeededComponents",value:function(e){var t=[],a=!0,r=!1,n=void 0;try{for(var o,i=e[Symbol.iterator]();!(a=(o=i.next()).done);a=!0){var s=o.value,u=AppConfig.components[s];if(!this.availableResources.has(u.url))if(isRegisteredHTMLElement(s));else if("react"==u.type&&this.registeredReactComponents.has(s));else{var p={url:u.url};u.template&&(t=t.concat(this.getNeededTemplates(u.template))),u.scripts&&(t=t.concat(this.getNeededScripts(u.scripts))),"react"==u.type?(p.type="react",p.componentName=s):p.type="web-component",t.push(p)}}}catch(l){r=!0,n=l}finally{try{!a&&i["return"]&&i["return"]()}finally{if(r)throw n}}return t}},{key:"loadResources",value:function(e){var t=e.needAuthentication,a=e.layout,r=e.error,n=this.loadNonBlockingDataGetBlockingData(t),o=[];if(o=o.concat(n),!this.globalDependenciesLoaded&&AppConfig.globalDependencies){var i=!0,s=!1,u=void 0;try{for(var p,l=AppConfig.globalDependencies[Symbol.iterator]();!(i=(p=l.next()).done);i=!0){var d=p.value;o.push({url:d.url,type:"global-dependency",wrap:d.wrap?d.wrap:void 0})}}catch(c){s=!0,u=c}finally{try{!i&&l["return"]&&l["return"]()}finally{if(s)throw u}}}this.availableResources.has(AppConfig.layouts[a].url)||(this.latestLoadedLayout=a,o.push({url:AppConfig.layouts[a].url,type:"script"})),AppConfig.layouts[a].template&&(o=o.concat(this.getNeededTemplates(AppConfig.layouts[a].template))),AppConfig.layouts[a].scripts&&(o=o.concat(this.getNeededScripts(AppConfig.layouts[a].scripts))),AppConfig.layouts[a].components&&(o=o.concat(this.getNeededComponents(AppConfig.layouts[a].components))),r||(AppConfig.pages[this.currentPage].template&&(o=o.concat(this.getNeededTemplates(AppConfig.pages[this.currentPage].template))),AppConfig.pages[this.currentPage].scripts&&(o=o.concat(this.getNeededScripts(AppConfig.pages[this.currentPage].scripts))),AppConfig.pages[this.currentPage].components&&(o=o.concat(this.getNeededComponents(AppConfig.pages[this.currentPage].components))),this.availableResources.has(AppConfig.pages[this.currentPage].url)||o.push({url:AppConfig.pages[this.currentPage].url,type:"script"}));var h=r?function(){App.router.showError(r)}:function(){App.router.showPage()};o.length?App.resourceLoader.loadResources(o,t,function(){var e=!0,t=!1,a=void 0;try{for(var r,n=o[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var i=r.value;App.router.availableResources.add(i.url)}}catch(s){t=!0,a=s}finally{try{!e&&n["return"]&&n["return"]()}finally{if(t)throw a}}App.router.globalDependenciesLoaded=!0,h()}):h()}}]),e}(),ResourceLoader=function(){function ResourceLoader(){_classCallCheck(this,ResourceLoader),this.unresolvedResourcesCounter=0,this.urlPrefix="dev"==AppConfig.mode?AppConfig.devModeUrlPrefix:AppConfig.prodModeUrlPrefix}return _createClass(ResourceLoader,[{key:"saveData",value:function(e,t){if("json"==AppConfig.data[e].type&&AppConfig.data[e].key){var a=AppConfig.data[e].key;App.dataStore.data[e]={};var r=JSON.parse(t),n=!0,o=!1,i=void 0;try{for(var s,u=r[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var p=s.value;App.dataStore.data[e][p[a]]=p}}catch(l){o=!0,i=l}finally{try{!n&&u["return"]&&u["return"]()}finally{if(o)throw i}}}else"json"==AppConfig.data[e].type&&t?App.dataStore.data[e]=JSON.parse(t):t&&(App.dataStore.data[e]=t)}},{key:"handleNonBlockingData",value:function(e,t){this.saveData(e,t);for(var a=App.dataStore.actionPool.length;a--;){var r=App.dataStore.actionPool[a];r.dataName==e&&(t&&(r.specific?r.action(App.dataStore.data[r.dataName][r.specific]):r.action(App.dataStore.data[r.dataName])),App.dataStore.actionPool.splice(a,1))}}},{key:"loadData",value:function(e,t){var a=this,r=!0,n=!1,o=void 0;try{for(var i,s=function(){var e=i.value,r=new XMLHttpRequest;r.open("GET",e.url,!0);var n=a;r.onload=function(t){-1!=n.unresolvedResourcesCounter&&(200==r.status?n.handleNonBlockingData(e.name,r.response):400==r.status?n.handleError():401==r.status?n.handleError("unauthorized"):n.handleError())},r.onerror=function(){n.handleError("timeout")},t&&r.setRequestHeader("Authorization","Bearer "+App.token),r.send()},u=e[Symbol.iterator]();!(r=(i=u.next()).done);r=!0)s()}catch(p){n=!0,o=p}finally{try{!r&&u["return"]&&u["return"]()}finally{if(n)throw o}}}},{key:"handleError",value:function(e){App.router.showError(e),this.unresolvedResourcesCounter=-1}},{key:"loadTemplate",value:function(e,t){this.sendRequest(e,function(e){App.router.htmlTemplates.set(t,e)})}},{key:"loadReactComponent",value:function loadReactComponent(url,componentName){this.sendRequest(url,function(response){window[componentName]=React.createFactory(eval(response))})}},{key:"loadScript",value:function(e){this.sendRequest(e,function(e){var t=document.getElementsByTagName("head")[0],a=document.createElement("script");a.innerHTML=e,t.appendChild(a)})}},{key:"loadBlockingData",value:function(e,t){var a=this;this.sendRequest(e,function(e){a.saveData(t,e)})}},{key:"loadGlobalDependency",value:function(e){var t=e.url;e.wrap;this.sendRequest(t,function(e){var t=document.getElementsByTagName("head")[0],a=document.createElement("script");a.innerHTML=e,t.appendChild(a)})}},{key:"sendRequest",value:function(e,t){if(-1!=this.unresolvedResourcesCounter){e=e.startsWith("https://")?e:this.urlPrefix+e;var a=this;xhr_get({url:e,token:a.auth?App.token:!1,success:function(e){-1!=a.unresolvedResourcesCounter&&(t(e),a.unresolvedResourcesCounter-=1,0==a.unresolvedResourcesCounter&&a.success())},unauthorized:function(){a.handleError("unauthorized")},timeout:function(){a.handleError("timeout")},badRequest:function(){a.handleError()}})}}},{key:"loadResources",value:function(e,t,a){this.unresolvedResourcesCounter=e.length,this.auth=t,this.success=a;var r=!0,n=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var u=i.value;"script"==u.type||"web-component"==u.type?this.loadScript(u.url):"template"==u.type?this.loadTemplate(u.url,u.name):"react-component"==u.type?this.loadReactComponent(u.url,u.componentName):"global-dependency"==u.type?this.loadGlobalDependency(u):this.loadBlockingData(u.url,u.name)}}catch(p){n=!0,o=p}finally{try{!r&&s["return"]&&s["return"]()}finally{if(n)throw o}}}}]),ResourceLoader}(),DataStore=function(){function e(){_classCallCheck(this,e),this.dataChanges={},this.dataKeys={},this.unresolovedDataChangesCounter={};for(var t in AppConfig.data)AppConfig.data[t].key&&(this.dataKeys[t]=AppConfig.data[t].key);this.data={},this.actionPool=[]}return _createClass(e,[{key:"getData",value:function(e,t){if(t){if(this.data[e]&&this.data[e][t])return Object.assign({},this.data[e][t])}else if(this.data[e])return Object.assign({},this.data[e])}},{key:"dataHandler",value:function(e){e.specific&&App.dataStore.data[e.dataName]&&App.dataStore.data[e.dataName][e.specific]?e.action(App.dataStore.data[e.dataName][e.specific]):App.dataStore.actionPool.push(e)}},{key:"fillForm",value:function(e){var t=new FormData;if(t.append("table",AppConfig.data[e.dataName].table),e.key&&t.append("where",this.dataKeys[e.dataName]+"="+e.key),e.data){var a="";for(var r in e.data)a+=r+"="+e.data[r]+",";a=a.slice(0,-1),t.append("columns",a)}return t}},{key:"deleteData",value:function(e){var t={};t.method="DELETE",t.url=AppConfig.deleteURL,t.formData=App.dataStore.fillForm({key:e.key,dataName:e.dataName}),e.success?t.success=function(t){e.success(t),App.dataStore.deleteClientData({dataName:e.dataName,key:e.key})}:t.success=function(t){App.dataStore.deleteClientData({dataName:e.dataName,key:e.key})},e.error&&(t.error=e.error),this.ajaxREST(t)}},{key:"updateData",value:function(e){var t={};t.method="POST",t.url=AppConfig.updateURL,t.formData=App.dataStore.fillForm({key:e.key,data:e.data,dataName:e.dataName}),e.success?t.success=function(t){e.success(t),App.dataStore.updateClientData({dataName:e.dataName,key:e.key,data:JSON.parse(t)})}:t.success=function(t){App.dataStore.updateClientData({dataName:e.dataName,key:e.key,data:JSON.parse(t)})},e.error&&(t.error=e.error),this.ajaxREST(t)}},{key:"putData",value:function(e){var t={};t.method="PUT",t.url=AppConfig.putURL,t.formData=this.fillForm({data:e.data,dataName:e.dataName}),e.success?t.success=function(t){e.success(t),App.dataStore.putClientData({dataName:e.dataName,data:e.data})}:t.success=function(t){App.dataStore.putClientData({dataName:e.dataName,data:e.data})},e.error&&(t.error=e.error),this.ajaxREST(t)}},{key:"enqueueDataChange",value:function(e){var t=e.key?e.key:e.data[App.dataStore.dataKeys[e.dataName]];for(var a in this.dataChanges)if(e.dataName==a&&this.dataChanges[e.dataName][t]){var r=this.dataChanges[a];if("DELETE"==e.action)return void delete this.dataChanges[e.dataName][t];if("UPDATE"==e.action){if("DELETE"==r.action)delete this.dataChanges[e.dataName][t];else if("PUT"==r.action||"UPDATE"==r.action){for(var n in e.data)this.dataChanges[e.dataName][t][data][n]=e.data[n];return}}else"PUT"==e.action&&delete this.dataChanges[e.dataName][t]}this.dataChanges[e.dataName]||(this.dataChanges[e.dataName]={}),this.dataChanges[e.dataName][t]={action:e.action,data:e.data?e.data:"undefined"}}},{key:"deleteClientData",value:function(e){delete this.data[e.dataName][e.key]}},{key:"updateClientData",value:function(e){var t=e.key;for(var a in e.data)a==this.dataKeys[e.dataName]&&(t=e.data[a],this.data[e.dataName][t]=this.data[e.dataName][e.key],this.data[e.dataName][t][a]=e.data[a],delete this.data[e.dataName][e.key])}},{key:"putClientData",value:function(e){App.dataStore.data[e.dataName]||(App.dataStore.data[e.dataName]={}),App.dataStore.data[e.dataName][e.data[AppConfig.data[e.dataName].key]]=e.data}},{key:"ajaxREST",value:function(e){var t=new XMLHttpRequest;t.open(e.method,e.url,!0),t.onload=function(){200==t.status?e.success&&e.success(t.response):e.error&&e.error(t.response)},App.token&&t.setRequestHeader("Authorization","Bearer "+App.token),e.timeout&&e.error&&e.error(t.response),t.send(e.formData)}},{key:"syncData",value:function(e){var t=this;if(this.dataChanges[e.dataName]){this.unresolovedDataChangesCounter[e.dataName]=Object.keys(this.dataChanges[e.dataName]).length;var a=function(a){var r=t.dataChanges[e.dataName][a];r.dataName=e.dataName,r.key=a;var n={};n.formData=t.fillForm(r),n.method==e.action,"UPDATE"==r.action?n.url=AppConfig.updateURL:"PUT"==r.action?n.url=AppConfig.putURL:"DELETE"==r.action&&(n.url=AppConfig.deleteURL),e.error?n.error=function(t){e.error(t),App.dataStore.unresolovedDataChangesCounter[e.dataName]=-1}:n.error=function(t){App.dataStore.unresolovedDataChangesCounter[e.dataName]=-1},e.success?n.success=function(t){delete App.dataStore.dataChanges[e.dataName][a],App.dataStore.unresolovedDataChangesCounter[e.dataName]--,0==App.dataStore.unresolovedDataChangesCounter[e.dataName]&&e.success(t)}:n.success=function(t){delete App.dataStore.dataChanges[e.dataName][a],App.dataStore.unresolovedDataChangesCounter[e.dataName]--},t.ajaxREST(n)};for(var r in this.dataChanges[e.dataName])a(r)}}}]),e}(),App={init:function(){if(App.router||(App.router=new Router,App.resourceLoader=new ResourceLoader,App.dataStore=new DataStore),this.eventListeners={},AppConfig.onAppInit){var e=!0,t=!1,a=void 0;try{for(var r,n=AppConfig.onAppInit[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var o=r.value;o()}}catch(i){t=!0,a=i}finally{try{!e&&n["return"]&&n["return"]()}finally{if(t)throw a}}}App.router.servePage()},getUniqueId:function(){return this.idSerial||(this.idSerial=0),this.idSerial++,"_appId_"+this.idSerial},removeAllEventListeners:function(){this.eventListeners&&(this.eventListeners={})},getUrlParam:function(e){return App.router.urlParams[e]?copy(App.router.urlParams[e]):void 0},emit:function(e,t){if(this.eventListeners&&this.eventListeners[e])for(var a in App.eventListeners[e]){var r=this.eventListeners[e][a];t?r.callback(t):r.callback()}},removeEventListener:function(e,t){this.eventListeners&&this.eventListeners[e]&&delete this.eventListeners[e][t]},on:function(e){var t=e.event,a=e.callback,r=e.id;this.eventListeners[t]||(this.eventListeners[t]={}),this.eventListeners[t][r]={callback:a}},dataHandler:function(e){this.dataStore.dataHandler(e)},updateData:function(e){this.dataStore.updateData(e)},putData:function(e){this.dataStore.putData(e)},deleteData:function(e){this.dataStore.deleteData(e)},putClientData:function(e){this.dataStore.putClientData(e),e.action="PUT",this.dataStore.enqueueDataChange(e)},updateClientData:function(e){this.dataStore.updateClientData(e),e.action="UPDATE",this.dataStore.enqueueDataChange(e)},deleteClientData:function(e){this.dataStore.deleteClientData(e),e.action="DELETE",this.dataStore.enqueueDataChange(e)},syncData:function(e){this.dataStore.syncData(e)},navigate:function(e,t){if("string"==typeof e)App.router.navigate(e);else{var a=function(){var a=function n(e){return e.href?e.href.substring(App.router.defaultUrlLength):e.parentElement?n(e.parentElement):"404"};e.preventDefault();var r=a(e.target);return"404"===r?(App.router.showError("pageNotFound"),{v:void 0}):void(t?App.router.navigate(r,!0):App.router.navigate(r))}();if("object"===("undefined"==typeof a?"undefined":_typeof(a)))return a.v}},reloadPage:function(){App.router.showPage()},setAuthLevel:function(e){App.authLevel=e},getAuthLevel:function(){return copy(App.authLevel)},getUserName:function(){return copy(App.userName)},login:function(e){var t=e.userName,a=e.token,r=e.authLevel;App.userName=t,App.token=a,App.authLevel=r},logout:function(){App.userName&&delete App.userName,App.token&&delete App.token,App.authLevel&&delete App.authLevel},newPage:function(e){App.router.Pages.set(App.router.currentPage,e)},newLayout:function(e){App.router.layouts[App.router.latestLoadedLayout]=e}};App.init(),window.addEventListener("popstate",App.init);